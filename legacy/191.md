---
uuid: 191
title: 超越 STL-map/hash_map性能的DICT
status: publish
date: 2007-11-23 18:54:42
categories: 编程技术
tags: 算法
---
最近用纯 C 作了一个 dict，根据试验，比 stl 的 map 快 2.3-2.5 倍，比 hash_map 快 1.3 倍，主要用到的优化策略如下：  

1\. skiplist： 

传统 hash-bucket 中，使用链表靠 next, 指针记录同一个 bucket 中的各个节点，查找时候需要一个一个的搜索，而改进以后的 bucket 节点，使用 next, next4,
next8 三级指针，分别指向后一个节点，后四个节点，后八个节点，如此保证链表有序的情况下，如果要搜索，就直接考虑 next8 的值和当前值大小，如果小于当前值，直接跳过八个节点，如果大于那再一次判断 next4 与 next。如此有序链表的遍历速度提高了 8 倍。 

2\. 双 hash：

使用两次 hash，开辟一个长度为 64 的 LRU 数组，记录最近访问过的节点，使用 hash2来定位 LRU 数组的位置，当搜索发生时，首先根据 hash2 在 LRU 数组中查找是否最近访问过该节点，如果访问过就直接返回，如果没有访问过则继续用 hash1 在 bucket 中查找，如果查找到的话，就按照 hash2的值覆盖一下 LRU 中该位置的数据。 再加上一些内存管理方面的优化，以及一些编码方式的改进，对 key/value 分别取 string 或 int，四种情况下，平均比 stl的 map 快 2.3-2.5 倍，比 hash_map快 1.3倍。
